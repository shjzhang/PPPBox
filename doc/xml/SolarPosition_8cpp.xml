<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.3.1">
  <compounddef id="SolarPosition_8cpp" kind="file">
    <compoundname>SolarPosition.cpp</compoundname>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#pragma<sp/>ident<sp/>&quot;$Id$&quot;</highlight></codeline>
<codeline lineno="2"><highlight class="preprocessor"></highlight></codeline>
<codeline lineno="7"><highlight class="comment">//<sp/>======================================================================</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="comment">//<sp/>This<sp/>software<sp/>was<sp/>developed<sp/>by<sp/>Applied<sp/>Research<sp/>Laboratories,<sp/>The</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">//<sp/>University<sp/>of<sp/>Texas<sp/>at<sp/>Austin<sp/>under<sp/>contract<sp/>to<sp/>an<sp/>agency<sp/>or<sp/>agencies</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">//<sp/>within<sp/>the<sp/>U.S.<sp/>Department<sp/>of<sp/>Defense.<sp/>The<sp/>U.S.<sp/>Government<sp/>retains<sp/>all</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">//<sp/>rights<sp/>to<sp/>use,<sp/>duplicate,<sp/>distribute,<sp/>disclose,<sp/>or<sp/>release<sp/>this</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">//<sp/>software.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">//<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Copyright<sp/>2008<sp/>The<sp/>University<sp/>of<sp/>Texas<sp/>at<sp/>Austin</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">//<sp/>======================================================================</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">//------------------------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">//<sp/>includes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="comment">//<sp/>system</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="comment">//<sp/>GPSTk</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="CommonTime_8hpp" kindref="compound">CommonTime.hpp</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="Position_8hpp" kindref="compound">Position.hpp</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="GNSSconstants_8hpp" kindref="compound">GNSSconstants.hpp</ref>&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TWO_PI</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="geometry_8hpp" kindref="compound">geometry.hpp</ref>&quot;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>DEG_TO_RAD</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="SolarPosition_8hpp" kindref="compound">SolarPosition.hpp</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="YDSTime_8hpp" kindref="compound">YDSTime.hpp</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="JulianDate_8hpp" kindref="compound">JulianDate.hpp</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal">gpstk<sp/>{</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">using<sp/>namespace<sp/></highlight><highlight class="normal">std;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="comment">//------------------------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Compute<sp/>Greenwich<sp/>Mean<sp/>Sidereal<sp/>Time<sp/>in<sp/>degrees</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>GMST(gpstk::CommonTime<sp/>t)</highlight></codeline>
<codeline lineno="35"><highlight class="normal">{</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>JulianEpoch=2451545;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>days<sp/>since<sp/>epoch</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>days<sp/>=(<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">JulianDate</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(t).jd<sp/>-<sp/>JulianEpoch);<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>days</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(days<sp/>&lt;=<sp/>0.0)<sp/>days<sp/>-=<sp/>1.0;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>Tp<sp/>=<sp/>days/36525.0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>dim-less</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Compute<sp/>GMST<sp/>in<sp/>radians</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>G;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>seconds<sp/>(24060s<sp/>=<sp/>6h<sp/>41min)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//G<sp/>=<sp/>24110.54841<sp/>+<sp/>(8640184.812866<sp/>+<sp/>(0.093104<sp/>-<sp/>6.2e-6*Tp)*Tp)*Tp;<sp/><sp/><sp/>//<sp/>sec</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//G<sp/>/=<sp/>86400.0;<sp/>//<sp/>instead,<sp/>divide<sp/>the<sp/>numbers<sp/>above<sp/>manually</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/>G<sp/>=<sp/>0.279057273264<sp/>+<sp/>100.0021390378009*Tp<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>seconds/86400<sp/>=<sp/>days</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>(0.093104<sp/>-<sp/>6.2e-6*Tp)*Tp*Tp/86400.0;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/>G<sp/>+=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">YDSTime</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(t).sod/86400.0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>days</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>put<sp/>answer<sp/>between<sp/>0<sp/>and<sp/>360<sp/>deg</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/>G<sp/>=<sp/>fmod(G,1.0);</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(G<sp/>&lt;<sp/>0.0)<sp/>G<sp/>+=<sp/>1.0;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/>G<sp/>*=<sp/>360.0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>degrees</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>G;</highlight></codeline>
<codeline lineno="58"><highlight class="normal">}</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight><highlight class="comment">//------------------------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="comment">//<sp/>accuracy<sp/>is<sp/>about<sp/>1<sp/>arcminute,<sp/>when<sp/>t<sp/>is<sp/>within<sp/>2<sp/>centuries<sp/>of<sp/>2000.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Ref.<sp/>Astronomical<sp/>Almanac<sp/>pg<sp/>C24,<sp/>as<sp/>presented<sp/>on<sp/>USNO<sp/>web<sp/>site.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="comment">//<sp/>input</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>t<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>epoch<sp/>of<sp/>interest</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight><highlight class="comment">//<sp/>output</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>lat,lon,R<sp/><sp/><sp/><sp/><sp/>latitude,<sp/>longitude<sp/>and<sp/>distance<sp/>(deg,deg,m<sp/>in<sp/>ECEF)<sp/>of<sp/>sun<sp/>at<sp/>t.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>AR<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>apparent<sp/>angular<sp/>radius<sp/>of<sp/>sun<sp/>as<sp/>seen<sp/>at<sp/>Earth<sp/>(deg)<sp/>at<sp/>t.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal">Position<sp/>SolarPosition(CommonTime<sp/>t,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal">&amp;<sp/>AR)<sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal">()</highlight></codeline>
<codeline lineno="71"><highlight class="normal">{</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//const<sp/>double<sp/>mPerAU<sp/>=<sp/>149598.0e6;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>D;<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>days<sp/>since<sp/>J2000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>g,q;<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>q<sp/>is<sp/>mean<sp/>longitude<sp/>of<sp/>sun,<sp/>corrected<sp/>for<sp/>aberration</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>L;<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>sun&apos;s<sp/>geocentric<sp/>apparent<sp/>ecliptic<sp/>longitude<sp/>(deg)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//double<sp/>b=0;<sp/>//<sp/>sun&apos;s<sp/>geocentric<sp/>apparent<sp/>ecliptic<sp/>latitude<sp/>(deg)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>e;<sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>mean<sp/>obliquity<sp/>of<sp/>the<sp/>ecliptic<sp/>(deg)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//double<sp/>R;<sp/><sp/><sp/>//<sp/>sun&apos;s<sp/>distance<sp/>from<sp/>Earth<sp/>(m)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>RA;<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>sun&apos;s<sp/>right<sp/>ascension<sp/>(deg)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>DEC;<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>sun&apos;s<sp/>declination<sp/>(deg)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//double<sp/>AR;<sp/><sp/>//<sp/>sun&apos;s<sp/>apparent<sp/>angular<sp/>radius<sp/>as<sp/>seen<sp/>at<sp/>Earth<sp/>(deg)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/>D<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">JulianDate</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(t).jd<sp/>-<sp/>2451545.0;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/>g<sp/>=<sp/>(357.529<sp/>+<sp/>0.98560028<sp/>*<sp/>D)<sp/>*<sp/>DEG_TO_RAD;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>AA<sp/>1990<sp/>has<sp/>g<sp/>=<sp/>(357.528<sp/>+<sp/>0.9856003<sp/>*<sp/>D)<sp/>*<sp/>DEG_TO_RAD;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/>q<sp/>=<sp/>280.459<sp/>+<sp/>0.98564736<sp/>*<sp/>D;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>AA<sp/>1990<sp/>has<sp/>q<sp/>=<sp/>280.460<sp/>+<sp/>0.9856474<sp/>*<sp/>D;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/>L<sp/>=<sp/>(q<sp/>+<sp/>1.915<sp/>*<sp/>std::sin(g)<sp/>+<sp/>0.020<sp/>*<sp/>std::sin(2*g))<sp/>*<sp/>DEG_TO_RAD;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/>e<sp/>=<sp/>(23.439<sp/>-<sp/>0.00000036<sp/>*<sp/>D)<sp/>*<sp/>DEG_TO_RAD;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>AA<sp/>1990<sp/>has<sp/>e<sp/>=<sp/>(23.439<sp/>-<sp/>0.0000004<sp/>*<sp/>D)<sp/>*<sp/>DEG_TO_RAD;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/>RA<sp/>=<sp/>std::atan2(std::cos(e)*std::sin(L),std::cos(L))<sp/>*<sp/>RAD_TO_DEG;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/>DEC<sp/>=<sp/>std::asin(std::sin(e)*std::sin(L))<sp/>*<sp/>RAD_TO_DEG;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>equation<sp/>of<sp/>time<sp/>=<sp/>apparent<sp/>solar<sp/>time<sp/>minus<sp/>mean<sp/>solar<sp/>time</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>=<sp/>[q-RA<sp/>(deg)]/(15deg/hr)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>compute<sp/>the<sp/>hour<sp/>angle<sp/>of<sp/>the<sp/>vernal<sp/>equinox<sp/>=<sp/>GMST<sp/>and<sp/>convert<sp/>RA<sp/>to<sp/>lon</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>lon<sp/>=<sp/>fmod(RA-GMST(t),360.0);</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(lon<sp/>&lt;<sp/>-180.0)<sp/>lon<sp/>+=<sp/>360.0;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(lon<sp/>&gt;<sp/><sp/>180.0)<sp/>lon<sp/>-=<sp/>360.0;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>lat<sp/>=<sp/>DEC;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ECEF<sp/>unit<sp/>vector<sp/>in<sp/>direction<sp/>Earth<sp/>to<sp/>sun</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>xhat<sp/>=<sp/>std::cos(lat*DEG_TO_RAD)*std::cos(lon*DEG_TO_RAD);</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>yhat<sp/>=<sp/>std::cos(lat*DEG_TO_RAD)*std::sin(lon*DEG_TO_RAD);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>zhat<sp/>=<sp/>std::sin(lat*DEG_TO_RAD);</highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>R<sp/>in<sp/>AU</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>R<sp/>=<sp/>1.00014<sp/>-<sp/>0.01671<sp/>*<sp/>std::cos(g)<sp/>-<sp/>0.00014<sp/>*<sp/>std::cos(2*g);</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>apparent<sp/>angular<sp/>radius<sp/>in<sp/>degrees</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/>AR<sp/>=<sp/>0.2666/R;</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>convert<sp/>to<sp/>meters</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/>R<sp/>*=<sp/>149598.0e6;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/>Position<sp/>ES;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/>ES.setECEF(R*xhat,R*yhat,R*zhat);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ES;</highlight></codeline>
<codeline lineno="120"><highlight class="normal">}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="comment">//------------------------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Compute<sp/>the<sp/>position<sp/>(latitude<sp/>and<sp/>longitude,<sp/>in<sp/>degrees)<sp/>of<sp/>the<sp/>sun</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight><highlight class="comment">//<sp/>given<sp/>the<sp/>day<sp/>of<sp/>year<sp/>and<sp/>the<sp/>hour<sp/>of<sp/>the<sp/>day.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Adapted<sp/>from<sp/>sunpos<sp/>by<sp/>D.<sp/>Coco<sp/>12/15/94</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>CrudeSolarPosition(CommonTime<sp/>t,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal">&amp;<sp/>lat,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal">&amp;<sp/>lon)<sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal">()</highlight></codeline>
<codeline lineno="127"><highlight class="normal">{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>doy<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">YDSTime</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(t).doy;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>hod<sp/>=<sp/>int(static_cast&lt;YDSTime&gt;(t).sod/3600.0<sp/>+<sp/>0.5);</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/>lat<sp/>=<sp/>std::sin(23.5*DEG_TO_RAD)*std::sin(TWO_PI*</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">(doy-83)/365.25);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/>lat<sp/>=<sp/>lat<sp/>/<sp/>std::sqrt(1.0-lat*lat);</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/>lat<sp/>=<sp/>RAD_TO_DEG*std::atan(lat);</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/>lon<sp/>=<sp/>180.0<sp/>-<sp/>hod*15.0;</highlight></codeline>
<codeline lineno="134"><highlight class="normal">}</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight><highlight class="comment">//------------------------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Consider<sp/>the<sp/>sun<sp/>and<sp/>the<sp/>earth<sp/>as<sp/>seen<sp/>from<sp/>the<sp/>satellite.<sp/>Let<sp/>the<sp/>sun<sp/>be<sp/>a<sp/>circle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight><highlight class="comment">//<sp/>of<sp/>angular<sp/>radius<sp/>r,<sp/>center<sp/>in<sp/>direction<sp/>s,<sp/>and<sp/>the<sp/>earth<sp/>be<sp/>a<sp/>(larger)<sp/>circle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight><highlight class="comment">//<sp/>of<sp/>angular<sp/>radius<sp/>R,<sp/>center<sp/>in<sp/>direction<sp/>e.<sp/>The<sp/>circles<sp/>overlap<sp/>if<sp/>|e-s|<sp/>&lt;<sp/>R+r;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight><highlight class="comment">//<sp/>complete<sp/>overlap<sp/>if<sp/>|e-s|<sp/>&lt;<sp/>R.<sp/>Let<sp/>L<sp/>==<sp/>|e-s|.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>What<sp/>is<sp/>the<sp/>area<sp/>of<sp/>overlap<sp/>if<sp/>R-r<sp/>&lt;<sp/>L<sp/>&lt;<sp/>R+r<sp/>?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Call<sp/>the<sp/>two<sp/>points<sp/>where<sp/>the<sp/>circles<sp/>intersect<sp/>p1<sp/>and<sp/>p2.<sp/>Draw<sp/>a<sp/>line<sp/>from<sp/>e<sp/>to<sp/>s;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight><highlight class="comment">//<sp/>call<sp/>the<sp/>points<sp/>where<sp/>this<sp/>line<sp/>intersects<sp/>the<sp/>two<sp/>circles<sp/>r1<sp/>and<sp/>R1,<sp/>respectively.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Draw<sp/>lines<sp/>from<sp/>e<sp/>to<sp/>s,<sp/>e<sp/>to<sp/>p1,<sp/>e<sp/>to<sp/>p2,<sp/>s<sp/>to<sp/>p1<sp/>and<sp/>s<sp/>to<sp/>p2.<sp/>Call<sp/>the<sp/>angle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight><highlight class="comment">//<sp/>between<sp/>e-s<sp/>and<sp/>e-p1<sp/>alpha,<sp/>and<sp/>that<sp/>between<sp/>s-e<sp/>and<sp/>s-p1,<sp/>beta.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Draw<sp/>a<sp/>rectangle<sp/>with<sp/>top<sp/>and<sp/>bottom<sp/>parallel<sp/>to<sp/>e-s<sp/>passing<sp/>through<sp/>p1<sp/>and<sp/>p2,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight><highlight class="comment">//<sp/>and<sp/>with<sp/>sides<sp/>passing<sp/>through<sp/>s<sp/>and<sp/>r1.<sp/>Similarly<sp/>for<sp/>e<sp/>and<sp/>R1.<sp/>Note<sp/>that<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight><highlight class="comment">//<sp/>area<sp/>of<sp/>intersection<sp/>lies<sp/>within<sp/>the<sp/>intersection<sp/>of<sp/>these<sp/>two<sp/>rectangles.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Call<sp/>the<sp/>area<sp/>of<sp/>the<sp/>rectangle<sp/>outside<sp/>the<sp/>circles<sp/>A<sp/>and<sp/>B.<sp/>The<sp/>height<sp/>H<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight><highlight class="comment">//<sp/>rectangles<sp/>is</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight><highlight class="comment">//<sp/>H<sp/>=<sp/>2Rsin(alpha)<sp/>=<sp/>2rsin(beta)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight><highlight class="comment">//<sp/>also<sp/>L<sp/>=<sp/>rcos(beta)+Rcos(alpha)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight><highlight class="comment">//<sp/>The<sp/>area<sp/>A<sp/>will<sp/>be<sp/>the<sp/>area<sp/>of<sp/>the<sp/>rectangle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>minus<sp/>the<sp/>area<sp/>of<sp/>the<sp/>wedge<sp/>formed<sp/>by<sp/>the<sp/>angle<sp/>2*alpha</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>minus<sp/>the<sp/>area<sp/>of<sp/>the<sp/>two<sp/>triangles<sp/>which<sp/>meet<sp/>at<sp/>s<sp/>:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight><highlight class="comment">//<sp/>A<sp/>=<sp/>RH<sp/>-<sp/>(2alpha/2pi)*pi*R*R<sp/>-<sp/>2*(1/2)*(H/2)Rcos(alpha)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Similarly</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight><highlight class="comment">//<sp/>B<sp/>=<sp/>rH<sp/>-<sp/>(2beta/2pi)*pi*r*r<sp/><sp/>-<sp/>2*(1/2)*(H/2)rcos(beta)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight><highlight class="comment">//<sp/>The<sp/>area<sp/>of<sp/>intersection<sp/>will<sp/>be<sp/>the<sp/>area<sp/>of<sp/>the<sp/>rectangular<sp/>intersection</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>minus<sp/>the<sp/>area<sp/>A</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>minus<sp/>the<sp/>area<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Intersection<sp/>=<sp/>H(R+r-L)<sp/>-<sp/>A<sp/>-<sp/>B</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>HR+Hr-HL<sp/>-HR+alpha*R*R+(H/2)Rcos(alpha)<sp/>-Hr+beta*r*r+(H/2)rcos(beta)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Cancel<sp/>terms,<sp/>and<sp/>substitute<sp/>for<sp/>L<sp/>using<sp/>above<sp/>equation<sp/>L<sp/>=<sp/>..</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>-(H/2)rcos(beta)-(H/2)Rcos(alpha)+alpha*R*R+beta*r*r</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight><highlight class="comment">//<sp/>substitute<sp/>for<sp/>H/2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>-R*R*sin(alpha)cos(alpha)-r*r*sin(beta)cos(beta)+alpha*R*R+beta*r*r</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Intersection<sp/>=<sp/>R*R*[alpha-sin(alpha)cos(alpha)]+r*r*[beta-sin(beta)cos(beta)]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Solve<sp/>for<sp/>alpha<sp/>and<sp/>beta<sp/>in<sp/>terms<sp/>of<sp/>R,<sp/>r<sp/>and<sp/>L<sp/>using<sp/>the<sp/>H<sp/>and<sp/>L<sp/>relations<sp/>above</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight><highlight class="comment">//<sp/>(r/R)cos(beta)=(L/R)-cos(alpha)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight><highlight class="comment">//<sp/>(r/R)sin(beta)=sin(alpha)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight><highlight class="comment">//<sp/>so</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight><highlight class="comment">//<sp/>(r/R)^2<sp/>=<sp/>(L/R)^2<sp/>-<sp/>(2L/R)cos(alpha)<sp/>+<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight><highlight class="comment">//<sp/>cos(alpha)<sp/>=<sp/>(R/2L)(1+(L/R)^2-(r/R)^2)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight><highlight class="comment">//<sp/>cos(beta)<sp/>=<sp/>(L/r)<sp/>-<sp/>(R/r)cos(alpha)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight><highlight class="comment">//<sp/>and<sp/>0<sp/>&lt;=<sp/>alpha<sp/>or<sp/>beta<sp/>&lt;=<sp/>pi</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Rearth<sp/><sp/><sp/><sp/>angular<sp/>radius<sp/>of<sp/>the<sp/>earth<sp/>as<sp/>seen<sp/>at<sp/>the<sp/>satellite</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Rsun<sp/><sp/><sp/><sp/><sp/><sp/>angular<sp/>radius<sp/>of<sp/>the<sp/>sun<sp/>as<sp/>seen<sp/>at<sp/>the<sp/>satellite</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight><highlight class="comment">//<sp/>dES<sp/><sp/><sp/><sp/><sp/><sp/><sp/>angular<sp/>distance<sp/>of<sp/>the<sp/>sun<sp/>from<sp/>the<sp/>earth</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight><highlight class="comment">//<sp/>return<sp/><sp/><sp/><sp/>fraction<sp/>(0<sp/>&lt;=<sp/>f<sp/>&lt;=<sp/>1)<sp/>of<sp/>area<sp/>of<sp/>sun<sp/>covered<sp/>by<sp/>earth</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight><highlight class="comment">//<sp/>units<sp/>only<sp/>need<sp/>be<sp/>consistent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>shadowFactor(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>Rearth,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>Rsun,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>dES)<sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal">()</highlight></codeline>
<codeline lineno="184"><highlight class="normal">{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(dES<sp/>&gt;=<sp/>Rearth+Rsun)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0.0;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(dES<sp/>&lt;=<sp/>std::fabs(Rearth-Rsun))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1.0;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>r=Rsun,<sp/>R=Rearth,<sp/>L=dES;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(Rsun<sp/>&gt;<sp/>Rearth)<sp/>{<sp/>r=Rearth;<sp/>R=Rsun;<sp/>}</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>cosalpha<sp/>=<sp/>(R/L)*(1.0+(L/R)*(L/R)-(r/R)*(r/R))/2.0;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>cosbeta<sp/>=<sp/>(L/r)<sp/>-<sp/>(R/r)*cosalpha;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>sinalpha<sp/>=<sp/>::sqrt(1-cosalpha*cosalpha);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>sinbeta<sp/>=<sp/>::sqrt(1-cosbeta*cosbeta);</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>alpha<sp/>=<sp/>::asin(sinalpha);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>beta<sp/>=<sp/>::asin(sinbeta);</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>shadow<sp/>=<sp/>r*r*(beta-sinbeta*cosbeta)+R*R*(alpha-sinalpha*cosalpha);</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/>shadow<sp/>/=<sp/>::acos(-1.0)*Rsun*Rsun;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>shadow;</highlight></codeline>
<codeline lineno="198"><highlight class="normal">}</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"></highlight><highlight class="comment">//------------------------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight><highlight class="comment">//<sp/>From<sp/>AA<sp/>1990<sp/>D46</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal">Position<sp/>LunarPosition(CommonTime<sp/>t,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal">&amp;<sp/>AR)<sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal">()</highlight></codeline>
<codeline lineno="203"><highlight class="normal">{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>days<sp/>since<sp/>J2000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>N<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">JulianDate</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(t).jd-2451545.0;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>centuries<sp/>since<sp/>J2000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>T<sp/>=<sp/>N/36525.0;</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ecliptic<sp/>longitude</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>lam<sp/>=<sp/>DEG_TO_RAD*(218.32<sp/>+<sp/>481267.883*T</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>6.29<sp/>*<sp/>::sin(DEG_TO_RAD*(134.9+477198.85*T))</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>1.27<sp/>*<sp/>::sin(DEG_TO_RAD*(259.2-413335.38*T))</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>0.66<sp/>*<sp/>::sin(DEG_TO_RAD*(235.7+890534.23*T))</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>0.21<sp/>*<sp/>::sin(DEG_TO_RAD*(269.9+954397.70*T))</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>0.19<sp/>*<sp/>::sin(DEG_TO_RAD*(357.5+<sp/>35999.05*T))</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>0.11<sp/>*<sp/>::sin(DEG_TO_RAD*(259.2+966404.05*T)));</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ecliptic<sp/>latitude</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>bet<sp/>=<sp/>DEG_TO_RAD*(5.13<sp/>*<sp/>::sin(DEG_TO_RAD*(<sp/>93.3+483202.03*T))</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>0.28<sp/>*<sp/>::sin(DEG_TO_RAD*(228.2+960400.87*T))</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>0.28<sp/>*<sp/>::sin(DEG_TO_RAD*(318.3+<sp/><sp/>6003.18*T))</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>0.17<sp/>*<sp/>::sin(DEG_TO_RAD*(217.6-407332.20*T)));</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>horizontal<sp/>parallax</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>par<sp/>=<sp/>DEG_TO_RAD*(0.9508</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>0.0518<sp/>*<sp/>::cos(DEG_TO_RAD*(134.9+477198.85*T))</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>0.0095<sp/>*<sp/>::cos(DEG_TO_RAD*(259.2-413335.38*T))</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>0.0078<sp/>*<sp/>::cos(DEG_TO_RAD*(235.7+890534.23*T))</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>0.0028<sp/>*<sp/>::cos(DEG_TO_RAD*(269.9+954397.70*T)));</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>obliquity<sp/>of<sp/>the<sp/>ecliptic</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>eps<sp/>=<sp/>(23.439<sp/>-<sp/>0.00000036<sp/>*<sp/>N)<sp/>*<sp/>DEG_TO_RAD;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>convert<sp/>ecliptic<sp/>lon,lat<sp/>to<sp/>geocentric<sp/>lon,lat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>l<sp/>=<sp/>::cos(bet)*::cos(lam);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>m<sp/>=<sp/>::cos(eps)*::cos(bet)*::sin(lam)<sp/>-<sp/>::sin(eps)*::sin(bet);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>::sin(eps)*::cos(bet)*::sin(lam)<sp/>+<sp/>::cos(eps)*::sin(bet);</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>convert<sp/>to<sp/>right<sp/>ascension<sp/>and<sp/>declination,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(referred<sp/>to<sp/>mean<sp/>equator<sp/>and<sp/>equinox<sp/>of<sp/>date)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>RA<sp/>=<sp/>::atan2(m,l)<sp/>*<sp/>RAD_TO_DEG;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>DEC<sp/>=<sp/>::asin(n)<sp/>*<sp/>RAD_TO_DEG;</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>compute<sp/>the<sp/>hour<sp/>angle<sp/>of<sp/>the<sp/>vernal<sp/>equinox<sp/>=<sp/>GMST<sp/>and<sp/>convert<sp/>RA<sp/>to<sp/>lon</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>lon<sp/>=<sp/>::fmod(RA-GMST(t),360.0);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(lon<sp/>&lt;<sp/>-180.0)<sp/>lon<sp/>+=<sp/>360.0;</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(lon<sp/>&gt;<sp/><sp/>180.0)<sp/>lon<sp/>-=<sp/>360.0;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>lat<sp/>=<sp/>DEC;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>apparent<sp/>semidiameter<sp/>of<sp/>moon<sp/>(in<sp/>radians)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/>AR<sp/>=<sp/>0.2725<sp/>*<sp/>par;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>moon<sp/>distance<sp/>in<sp/>meters</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>R<sp/>=<sp/>1.0<sp/>/<sp/>::sin(par);</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/>R<sp/>*=<sp/>6378137.0;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ECEF<sp/>vector<sp/>in<sp/>direction<sp/>Earth<sp/>to<sp/>moon</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>x<sp/>=<sp/>R*std::cos(lat*DEG_TO_RAD)*std::cos(lon*DEG_TO_RAD);</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>y<sp/>=<sp/>R*std::cos(lat*DEG_TO_RAD)*std::sin(lon*DEG_TO_RAD);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>z<sp/>=<sp/>R*std::sin(lat*DEG_TO_RAD);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/>Position<sp/>EM;</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/>EM.setECEF(x,y,z);</highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>EM;</highlight></codeline>
<codeline lineno="263"><highlight class="normal">}</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight><highlight class="comment">//------------------------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>end<sp/>namespace<sp/>gpstk</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/Users/shjzhang/Documents/Develop/rocket/lib/Geomatics/SolarPosition.cpp"/>
  </compounddef>
</doxygen>
